# Разработка Telegram-бота для управления деревом категорий на базе Spring Boot и PostgreSQL

## Цель: Создать Telegram-бота, который позволит пользователям создавать, просматривать и удалять дерево категорий
## Основные требования:
Проект должен быть реализован на Spring Boot.
- Для хранения информации о категориях используется база данных
  PostgreSQL.
- Документирование кода.
- Для работы с Telegram API рекомендуется использовать
  библиотеку TelegramBots.
- Для работы с базой данных можно использовать Spring Data JPA.
- Для обработки команд рекомендуется использовать шаблон
  проектирования Command.
- Загрузка, выгрузка данных из Excel

## Критерии оценки:
- Корректность выполнения команд.
- Структура кода, наличие комментариев и документации.
- Обработка возможных исключений и ошибок ввода пользователя.
- Использование принципов ООП и шаблонов проектирования.

# Основные технологии и фреймворки:
- Spring Boot
- Postgresql
- hypersistence-utils-hibernate-62
- telegrambots-abilities
- org.apache.poi

# Используемые сервисы

## Взаимодействие с telegaramBot (from the controller package)
- TelegramBot 
- ResponseHanlder
- MessageApi

## Структура шаблона стратегии
- service/strategyTempl/**
- service (бинКомпоненты)
  - Help
  - ViewTree
  - AddElement
  - RemoveElement


## ВСЕ команды ассоциированы с перечислением:
- COMD_REMOVE_ELEMENT -> /removeElement
- COMD_ADD_ELEMENT -> /addElement
- COMD_HELP -> /help
- COMD_VIEW_TREE -> /viewTree
- COMD_START -> /start
- COMD_DOWNLOAD -> /download (Выгрузка данных в Excel)
- COMD_UPLOAD -> /upload (Загрузка элементов в БД из Excel)
  

## Утилиты (utils/**)
- **FileAPI** сервис загрузки данных из файлов
- **Constanfs** константы
- **utils.excelAPI.ExcelService** утилита загрузки/выгрузки excel файлов.


  для загрузки и выгрузки данных из Excel требуются специальные шаблоны:   
  any-data/extenal-resource/template.xlsx шаблон для download    
  any-data/extenal-resource/test-upload-excel.xlsx образец для upload

------------- 

## Репозиторий (repositories)    
  Для скриптов, которые не поддерживаются Hibernate, использованы опции nativeQuery = true

  ВСЕ запросы покрыты модульными тестами.  
  ***ВНИМАНИЕ***: модульные тесты привязаны к состоянию БД при разработке
- TelegramChatRepository


### Структура класса-сущности (Groups)
- rootnode id корневого узла
- parentnode id родительского узла
- ordernum индекс размещения узла в пределах корневого узла
- levelnum уровень вложенности
- txtgroup  строковый идентификатор элемента (уникальные значения)

----------

Структура Groups содержит всю информацию по древовидной структуре.        
Добавление узла изменяет ordernum для всех ниже лежащих узлов, входящих в структуру своего корневого узла.       
Удаление узла изменяет значения ordernum, начиная с корневого узла.                    

Используемая структура позволяет создавать и управлять древовидной структурой любой вложенности.

## Загрузка из Excel:
- если нет корневого узла -> создается  
- в БД добавляются только НОВЫЕ ЭЛЕМЕНТЫ    
- если выполнить дважды операцию upload состояние БД не изменится  
- Шаблоны: см. выше в разделе Утилиты


